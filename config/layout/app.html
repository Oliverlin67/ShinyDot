<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="copyright" content="{forum_name}">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="{forum_about}"/>

<!--Open Graph-->
<meta property="og:url" content="{url}"/>
<meta property="og:locale" content="zh-TW"/>
<meta property="og:type" content="website"/>
<meta property="og:description" content="{forum_about}"/>
<meta property="og:image" content="{forum_logo}"/>
<meta property="og:image:type" content="image/png"/>

<!--Icons-->
<script src="https://kit.fontawesome.com/5890d0b371.js" crossorigin="anonymous"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F4NTK25MQ1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-F4NTK25MQ1');
</script>

<!--Google AdSense-->
<script data-ad-client="ca-pub-6761306742993948" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!--Styles-->
<link href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://forum.coyu.cc/css/style.css"/>

<!--JS-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://forum.coyu.cc/js/app.js"></script>

<!--favicon-->
<link rel="apple-touch-icon" sizes="57x57" href="https://forum.coyu.cc/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://forum.coyu.cc/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://forum.coyu.cc/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://forum.coyu.cc/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://forum.coyu.cc/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://forum.coyu.cc/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://forum.coyu.cc/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://forum.coyu.cc/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://forum.coyu.cc/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="https://forum.coyu.cc/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://forum.coyu.cc/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://forum.coyu.cc/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://forum.coyu.cc/favicon/favicon-16x16.png">
<link rel="manifest" href="https://forum.coyu.cc/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#d4fffb">
<meta name="msapplication-TileImage" content="https://forum.coyu.cc/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#d4fffb">
</head>   
<body>
<!--Modal-->
<div class="modal fade" id="board-list" tabindex="-1" aria-labelledby="BoardListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="BoardListModalLabel">看板列表</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="boardBlock" id="all">
                    <p><i class="fas fa-align-justify"></i>所有看板</p><i class="fas fa-angle-double-right"></i>
                </div>
                {board_list}
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">搜尋文章或用戶</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="search">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="輸入關鍵字搜尋" aria-describedby="search_btn">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit" id="search_btn">搜尋<i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="UploadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="UploadModalLabel">上傳圖片</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form enctype="multipart/formdata" id="uploadImage">
                    <div id="view_block">
                        <p class="text-left">圖片預覽:</p>
                        <img id="view" src="#" class="border border-primary rounded-lg" style="width:80%"/>
                        <br><br>
                    </div>
                    
                    <label class="btn btn-info">
                        <input id="upload_img" name="upload_img" style="display:none;" type="file" accept="image/gif, image/jpeg, image/png" multiple>
                        <i class="fa fa-photo"></i>選擇/更改 圖片
                    </label>
                    
                    <label class="btn btn-success" id="upload_b">
                        <i class="fas fa-paper-plane"></i>確認上傳
                    </label>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="container content">
    {main_part}
    <br id="bottom">
</div>
<script>
    function readURL(input){
        if(input.files && input.files[0]){
            var reader = new FileReader();
            reader.onload = function (e) {
                $("#view").attr('src', e.target.result);
                $("#view_block").show();
                $("#upload_b").show();
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('https://forum.coyu.cc/js/sw.js')
          .then((reg) => {
            // registration worked
            console.log('Registration succeeded. Scope is ' + reg.scope);
          }).catch((error) => {
            // registration failed
            console.log('Registration failed with ' + error);
          });
    }
    
    $(window).bind('beforeunload',function(){
        $('body').animate({ 
            marginLeft: '30px',
            opacity: '0.2'
        }, 200);
        const Loading = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false
        });
        Loading.fire({
            icon: "info",
            title: "載入中"
        });
    });
    $(document).ready(function(){
        $('body').animate({ 
            marginLeft: '0',
            opacity: '1'
        }, 200);
        
        $("#view_block").hide();
        $("#upload_b").hide();
        
        $("#upload_img").change(function(){
            readURL(this);
        });

        $(".share").click(async () => {
            try {
                await navigator.share({ title: "國中生匿名論壇 | ShinyDot", url: "{url}" });
                console.log("Data was shared successfully");
            } catch (err) {
                console.error("Share failed:", err.message);
            }
        });

        const Toast = Swal.mixin({
            toast: true,
            position: 'top',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        });
        
        $("#upload_b").click(function() {
            $("#upload_b").attr("disabled",true);
            $("#upload_img").attr("disabled",true);
            $("#upload_b").html('上傳中...');
            var formData = new FormData();
            formData.append('file', $('#upload_img')[0].files[0]);
            $.ajax({
                url: "https://forum.coyu.cc/action/imgUpload",
                type: "POST",
                data: formData,
                contentType: false,
                processData:false,
                success: function(data) {
                    $("#content").val($("#content").val() + '\n<img width="90%" class="rounded" src="https://forum.coyu.cc/ImgShow.php?file=' + data.fileid + '" title="img" alt="img"/>');
                    $("#uploadModal").modal("hide");
                    $("#uploadImage")[0].reset();
                	
                    Toast.fire({
                        title: data.Msg
                    });
                    
                    $("#upload_b").attr("disabled",false);
                    $("#upload_img").attr("disabled",false);
                    $("#upload_b").html('<i class="fas fa-paper-plane"></i>確認上傳');
                    $("#upload_b").hide();
                    $("#view_block").hide();
                    console.log(data);
                }          
            })
            return false;
        });
        $('#orderBy').on('change', function () {
            window.location = "https://forum.coyu.cc/b/{now_url}/" + $(this).val();
            return false;
        });
        //搜尋
        $("#search").submit(function(){
            window.location = "https://forum.coyu.cc/search/"+ $("#search input").val();
            return false;
        });

        
        $("#search_form").submit(function(){
            window.location = "https://forum.coyu.cc/search/"+ $("#search_form input").val();
            return false;
        });
        //註冊
        $("#register").submit(function(){
            $("#register button").html('<i class="fa fa-refresh fa-spin"></i>');
            $("#register button").attr("disabled",true);
            $.ajax({
                type:"POST",
                url: "https://forum.coyu.cc/action/user/register",
                dataType: 'json',
                data: {
                    user_name:$("#user_name").val(),
                    user_pwd:$("#user_pwd").val(),
                    profile_name:$("#profile_name").val(),
                    profile_nickname:$("#profile_nickname").val(),
                    profile_email:$("#profile_email").val(),
                    profile_sex:$("#profile_sex").val()
                },
                success: function (data) {
                    if(data.Msg == "註冊成功,請查看您的信箱"){
                        $("#register").html("<div class='alert alert-success'>" + data.Msg + "</div>");
                    }else{
                        Toast.fire({
                          icon: "info",
                          title: data.Msg
                        });
                        $("#register button").html('註冊');
                        $("#register button").attr("disabled",false);
                    }
                }
            });
            return false;
        });
        //登入
        $("#login").submit(function(){
            $("#login button").html('<i class="fa fa-refresh fa-spin"></i>');
            $("#login button").attr("disabled",true);
            $.ajax({
                type:"POST",
                url: "https://forum.coyu.cc/action/user/login",
                dataType: 'json',
                data: {
                    user:$("#user").val(),
                    pwd:$("#pwd").val()
                },
                success: function (data) {
                    if(data.Msg != "帳號或密碼錯誤"){
                        $("#login").html(data.Msg);
                        setTimeout(function (){
                            document.location.href="./";
                        },1500);
                    }else{
                        Toast.fire({
                          icon: "info",
                          title: data.Msg
                        });
                        $("#login button").html('登入');
                        $("#login button").attr("disabled",false);
                    }
                }
            });
            return false;
        });
    });
</script>
</body>
</html>